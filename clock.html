<!doctype html>
<html lang="en">
<head>
  <!-- Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="favicon.png">

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clock</title>
<style>
  
  /* Red dismiss button - round + hover */
#dismissAlarm {
  background: #ff3b3b;        /* bright red */
  color: #fff;
  border-radius: 50px;        /* makes it fully round */
  padding: 12px 20px;         /* adjust for roundness */
  font-weight: 700;
  cursor: grab;               /* shows draggable hand */
  box-shadow: 0 6px 18px rgba(255,0,0,0.5);
  transition: all 0.2s ease;
}

#dismissAlarm:hover {
  transform: scale(1.08);
  box-shadow: 0 8px 24px rgba(255,0,0,0.7);
}

  /* Draggable alarm dismiss button styling */
#dismissAlarm {
  background: #ff4c4c; /* bright red */
  color: #fff;
  font-weight: 700;
  font-size: 14px;
  box-shadow: 0 4px 16px rgba(255,76,76,0.4);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  cursor: grab;
}

#dismissAlarm:hover {
  transform: scale(1.08);
  box-shadow: 0 6px 24px rgba(255,76,76,0.6), 0 0 12px rgba(255,255,255,0.2);
}

  :root{
    --clock-size: 240px; /* used for layout reference */
    --glass: rgba(255,255,255,0.06);
    --glass-strong: rgba(255,255,255,0.12);
    --neon: #00ffc3;
    --brightText: #111;
    --darkText: #fff;
  }
  html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", system-ui, Arial; background-size:cover; background-position:center; transition:background 1s ease; background-color:#0b0b0d;}
  .stage{
    height:100vh; width:100vw;
    display:flex; align-items:center; justify-content:center;
  }

  /* central container */
  .center {
    position: relative;
    z-index: 50;
    width: var(--clock-size);
    height: var(--clock-size);
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }

  /* Clock card (above rings) */
  .clock-card{
    position: absolute;
    width: 320px;
    height: 132px;
    background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border-radius: 12px;
    backdrop-filter: blur(8px) saturate(120%);
    box-shadow: 0 6px 30px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index: 60; /* ensure above rings */
    pointer-events:auto;
  }

  /* Time text */
  .time-row{ display:flex; align-items:baseline; gap:0.6rem; }
  .time-digits{
    font-family: "Orbitron", Inter, sans-serif;
    font-weight:800;
    font-size:48px;
    letter-spacing: 0.02em;
    color: var(--darkText);
    text-shadow: 0 0 22px rgba(255,255,255,0.06), 0 0 40px rgba(0,255,195,0.12);
    display:flex;
    gap:0.45rem;
    pointer-events:none;
  }

  .digit {
    min-width: 58px;
    text-align:center;
    padding:8px 6px;
    border-radius:8px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));
    box-shadow: 0 6px 18px rgba(0,0,0,0.6), inset 0 2px 8px rgba(255,255,255,0.02);
    transform-origin: center;
  }

  /* flip animation applied only when value changes */
  .flip {
    animation: flipAnim 420ms cubic-bezier(.2,.9,.3,1);
  }
  @keyframes flipAnim{
    0%   { transform: rotateX(0deg); }
    45%  { transform: rotateX(-88deg); opacity:0; }
    100% { transform: rotateX(0deg); opacity:1; }
  }

  .ampm {
    font-size: 18px;
    margin-left: 6px;
    color: rgba(255,255,255,0.85);
    opacity:0.95;
  }

  .date-row{
    margin-top:6px;
    font-size:14px;
    color: rgba(255,255,255,0.8);
    text-shadow: 0 0 8px rgba(0,0,0,0.35);
  }

  /* Rings (absolute centered containers) */
  .ring {
    position:absolute;
    top:50%;
    left:50%;
    transform: translate(-50%,-50%);
    pointer-events:none;
    border-radius:50%;
    display:block;
    opacity:1;
    transition: opacity .6s ease;
  }
  /* when rings are hidden (faded out) */
  .rings-hidden .ring { opacity: 0; pointer-events: none; }

  .ring .ring-border{
    position:absolute;
    inset:0;
    border-radius:50%;
    border:1px solid rgba(255,255,255,0.08);
    box-shadow: 0 0 20px rgba(0,0,0,0.4), inset 0 0 20px rgba(255,255,255,0.02);
  }
  .ring .item{
    position:absolute;
    transform: translate(-50%,-50%); /* will set left/top in JS */
    white-space:nowrap;
    font-size:12px;
    color: #fff;
    opacity:0.95;
    pointer-events:none;
    user-select:none;
  }

  /* Settings (glass popup) */
  .settings-btn{
    position:fixed;
    right:22px;
    bottom:22px;
    width:64px;height:64px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    box-shadow: 0 6px 30px rgba(0,0,0,0.6);
    border:1px solid rgba(255,255,255,0.06);
    cursor:pointer; z-index:120; color:white;
    transition: transform .18s ease, box-shadow .18s ease;
    backdrop-filter: blur(6px) saturate(120%);
  }
  .settings-btn:hover{ transform: scale(1.06) rotate(8deg); box-shadow: 0 10px 30px rgba(0,255,195,0.14), 0 0 40px rgba(0,255,195,0.06); }

  .settings-panel{
    position:fixed; right:22px; bottom:100px; width:300px;
    background: linear-gradient(180deg, rgba(8,8,12,0.7), rgba(8,8,12,0.6));
    border-radius:12px; padding:14px; display:block; z-index:120;
    border:1px solid rgba(255,255,255,0.04); box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    opacity:0; transform:translateY(20px);
    pointer-events:none;
    transition: opacity 0.4s ease, transform 0.4s ease;
  }
  .settings-panel.open {
    opacity:1;
    transform:translateY(0);
    pointer-events:auto;
  }

  .settings-row{ display:flex; gap:8px; align-items:center; margin:8px 0; transition: background .25s ease, transform .18s ease; padding:8px; border-radius:8px; cursor:pointer; }
  .settings-row:hover{ background: rgba(255,255,255,0.03); transform: translateX(6px); }
  .settings-row label{ font-size:13px; color: #cdf9e9; min-width:80px; }

  input[type="datetime-local"], input[type="date"], input[type="time"]{
    width:160px; padding:8px; border-radius:8px; border:none;
    background: rgba(255,255,255,0.06); color:white; outline: none;
  }

  /* improved toggle */
  .toggle{position:relative; width:92px; height:40px; border-radius:40px; background:rgba(255,255,255,0.05); display:flex; align-items:center; justify-content:space-between; padding:0 8px; cursor:pointer; box-shadow:inset 0 1px 0 rgba(255,255,255,0.02); overflow:hidden; transition:background .25s ease, transform .2s ease;}
  .toggle:hover{background:rgba(255,255,255,0.08); transform:scale(1.05);}
  .toggle .label{flex:1; text-align:center; font-size:12px; color:rgba(255,255,255,0.65); pointer-events:none;}
  .toggle .knob{position:absolute; top:3px; left:3px; width:34px; height:34px; border-radius:50%; background:var(--neon); box-shadow:0 0 8px var(--neon), 0 0 16px rgba(0,255,195,0.4); transition:transform .25s cubic-bezier(.2,.9,.3,1), box-shadow .25s;}
  .toggle.active .knob{transform:translateX(52px); box-shadow:0 0 12px var(--neon), 0 0 24px rgba(0,255,195,0.5);}

  /* Alarm modal + overlay */
  .overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.38); opacity:0; pointer-events:none; transition:opacity .3s ease; z-index:180;
  }
  .overlay.show{ opacity:1; pointer-events:auto; }

  .alarm-modal{
    position:fixed;
    left:50%; top:50%;
    transform: translate(-50%,-50%) scale(0.98);
    width:340px;
    max-width:92%;
    background: rgba(12,12,16,0.45);
    border-radius:12px;
    padding:14px;
    backdrop-filter: blur(12px) saturate(120%);
    box-shadow: 0 18px 60px rgba(0,0,0,0.6);
    z-index:190;
    opacity:0;
    pointer-events:none;
    transition: transform .28s cubic-bezier(.2,.9,.3,1), opacity .28s ease;
  }
  .alarm-modal.open{ opacity:1; pointer-events:auto; transform: translate(-50%,-50%) scale(1); }

  .alarm-modal h3{ margin:0 0 8px 0; color:#bafee0; font-size:16px; }
  .alarm-row{ display:flex; gap:8px; align-items:center; margin-top:8px; }
  .preset-buttons{ display:flex; gap:8px; margin-top:10px; }
  .preset-buttons button{ flex:1; padding:8px; border-radius:8px; border:none; background: rgba(255,255,255,0.04); color:#fff; cursor:pointer; transition:all .18s ease; }
  .preset-buttons button:hover{ filter:brightness(1.08); transform:translateY(-2px); }
  .modal-actions{ display:flex; gap:8px; margin-top:12px; }
  .modal-actions .btn{ flex:1; padding:10px; border-radius:8px; border:none; cursor:pointer; }
  .btn.cancel{ background: rgba(255,255,255,0.06); color:#fff; }
  .btn.set{ background: var(--neon); font-weight:700; color:#042; }

  .dismiss-row{ margin-top:12px; display:none; gap:8px; }
  .dismiss-row.show{ display:flex; }

  /* small responsive */
  @media (max-width:720px){
    .clock-card{ width:92%; max-width:320px; }
    .time-digits{ font-size:34px; }
  }
  /* ===== Make alarm dismiss button draggable ===== */
(function(){
  const btn = dismissAlarmBtn; // already defined
  let isDragging = false, offsetX=0, offsetY=0;

  btn.style.position = 'absolute'; // ensure absolute positioning
  btn.style.display = 'none'; // hide until alarm triggers

  // show and center button when alarm triggers
  const originalTriggerAlarm = triggerAlarm;
  triggerAlarm = function(){
    originalTriggerAlarm();
    btn.style.display = 'flex';
    btn.style.left = (window.innerWidth - btn.offsetWidth)/2 + 'px';
    btn.style.top  = (window.innerHeight - btn.offsetHeight)/2 + 'px';
  };

  btn.addEventListener('mousedown', (e)=>{
    isDragging = true;
    offsetX = e.clientX - btn.offsetLeft;
    offsetY = e.clientY - btn.offsetTop;
    btn.style.cursor = 'grabbing';
  });

  window.addEventListener('mousemove', (e)=>{
    if(!isDragging) return;
    let x = e.clientX - offsetX;
    let y = e.clientY - offsetY;

    // constrain to window
    x = Math.max(0, Math.min(window.innerWidth - btn.offsetWidth, x));
    y = Math.max(0, Math.min(window.innerHeight - btn.offsetHeight, y));

    btn.style.left = x + 'px';
    btn.style.top  = y + 'px';
  });

  window.addEventListener('mouseup', ()=>{
    if(isDragging){
      isDragging = false;
      btn.style.cursor = 'grab';
    }
  });

  // hide button when alarm stops
  const originalStopAlarm = stopAlarm;
  stopAlarm = function(){
    originalStopAlarm();
    btn.style.display = 'none';
  };
})();

</style>
</head>
<body>
  <div class="stage">
    <!-- Rings (container elements) -->
    <div id="monthsRing" class="ring" aria-hidden="true"><div class="ring-border"></div></div>
    <div id="dateRing" class="ring reverse" aria-hidden="true"><div class="ring-border"></div></div>
    <div id="daysRing" class="ring" aria-hidden="true"><div class="ring-border"></div></div>

    <!-- center clock -->
    <div class="center" aria-hidden="false">
      <div class="clock-card" id="clockCard">
        <div class="time-row">
          <div class="time-digits" id="timeDigits" aria-live="polite">
            <div class="digit" id="hoursSpan"><span id="hoursText">00</span></div>
            <div class="digit" id="minutesSpan"><span id="minutesText">00</span></div>
            <div class="digit" id="secondsSpan"><span id="secondsText">00</span></div>
          </div>
          <div class="ampm" id="ampm"></div>
        </div>
        <div class="date-row" id="dateRow">Loading...</div>
      </div>
    </div>
  </div>

  <!-- settings -->
  <div class="settings-btn" id="settingsBtn" title="Settings">⚙️</div>
  <div class="settings-panel" id="settingsPanel" role="dialog" aria-hidden="true">
    <div style="font-weight:700;color:#bafee0;margin-bottom:6px">Settings</div>

    <div class="settings-row"><label>Custom date/time</label><input id="customDT" type="datetime-local" /></div>
    <div style="display:flex; gap:6px; margin-top:8px; align-items:center;">
      <button id="applyBtn" style="flex:1;padding:8px;border-radius:8px;border:none;background:var(--neon);font-weight:700;cursor:pointer">Apply</button>
      <button id="clearBtn" style="padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,0.06);color:white;cursor:pointer">Clear</button>
    </div>

    <div class="settings-row" style="align-items:center;">
      <label>Time format</label>
      <div id="formatToggle" class="toggle" title="Toggle 12/24 hour">
        <div class="label">24h</div>
        <div class="label">12h</div>
        <div class="knob"></div>
      </div>
    </div>

    <div class="settings-row" style="align-items:center;">
      <label>Spin rings</label>
      <div id="ringToggle" class="toggle" title="Toggle ring spin">
        <div class="label">On</div>
        <div class="label">Off</div>
        <div class="knob"></div>
      </div>
    </div>

    <div class="settings-row" style="align-items:center;">
      <label>Tick-tock sound</label>
      <div id="tickToggle" class="toggle" title="Toggle tick sound">
        <div class="label">Off</div>
        <div class="label">On</div>
        <div class="knob"></div>
      </div>
    </div>

    <div class="settings-row" id="openAlarm" style="align-items:center; cursor:pointer;">
      <label>⏰ Set Alarm</label>
    </div>

    <div style="height:8px"></div>
    <div style="font-size:12px;color:rgba(255,255,255,0.6)">Made By M.Abdullah Aftab <br>
      Be sure to check out my other Websites <a href="https://pdftopngtool.netlify.app/" style="color:var(--neon);text-decoration:none;" target="_blank" rel="noopener">PDF to PNG Tool</a> | <a href="https://knowyourhealth.netlify.app/" style="color:var(--neon);text-decoration:none;" target="_blank" rel="noopener">Health Percentage Checker</a> | <a href="https://abdullahsport.netlify.app/" style="color:var(--neon);text-decoration:none;" target="_blank" rel="noopener">My Portfolio</a></div>
    </div>
  </div>

  <!-- overlay for modal dim -->
  <div class="overlay" id="overlay"></div>

  <!-- Alarm Modal -->
  <div class="alarm-modal" id="alarmModal" aria-hidden="true">
    <h3>Set Alarm</h3>
    <div class="alarm-row">
      <input id="alarmTime" type="time" />
    </div>

    <div class="preset-buttons">
      <button data-min="5">+5 min</button>
      <button data-min="10">+10 min</button>
      <button data-min="15">+15 min</button>
      <button data-min="20">+20 min</button>
    </div>

    <div class="modal-actions">
      <button class="btn cancel" id="cancelAlarm">Cancel</button>
      <button class="btn set" id="saveAlarm">Set Alarm</button>
    </div>

    <div class="dismiss-row" id="dismissRow">
      <button class="btn cancel" id="dismissAlarm">Dismiss Alarm</button>
    </div>
  </div>

<script>
/* ========== CONFIG & state ========== */
const images = {
  sunrise: "sunrise.png",
  morning: "morning.png",
  afternoon: "afternoon.png",
  evening: "evening.png",
  night: "night.png"
};

let is24Hour = true;
let customDate = null; // Date object or null
let lastValues = { h: null, m: null, s: null };

/* ring objects (populated below) */
const rings = [
  { id: 'daysRing', items: ["SUN","MON","TUE","WED","THU","FRI","SAT"], speed: 0.02, dir: 1 },
  { id: 'dateRing', items: Array.from({length:31}, (_,i)=>String(i+1)), speed: 0.012, dir: -1 },
  { id: 'monthsRing', items: ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"], speed: 0.007, dir: 1 }
];

/* will hold per-ring runtime data */
const ringState = {};

/* DOM */
const hoursText = document.getElementById('hoursText');
const minutesText = document.getElementById('minutesText');
const secondsText = document.getElementById('secondsText');
const ampmEl = document.getElementById('ampm');
const dateRow = document.getElementById('dateRow');

const settingsBtn = document.getElementById('settingsBtn');
const settingsPanel = document.getElementById('settingsPanel');
const customDT = document.getElementById('customDT');
const applyBtn = document.getElementById('applyBtn');
const clearBtn = document.getElementById('clearBtn');

const formatToggle = document.getElementById('formatToggle');
const ringToggle = document.getElementById('ringToggle');
const tickToggle = document.getElementById('tickToggle');

const openAlarm = document.getElementById('openAlarm');
const overlay = document.getElementById('overlay');
const alarmModal = document.getElementById('alarmModal');
const cancelAlarm = document.getElementById('cancelAlarm');
const saveAlarm = document.getElementById('saveAlarm');
const alarmTime = document.getElementById('alarmTime');
const dismissRow = document.getElementById('dismissRow');
const dismissAlarmBtn = document.getElementById('dismissAlarm');

let spinEnabled = true; // default
let tickEnabled = false; // default off
let alarmSet = null; // {h, m} or null
let alarmRinging = false;

/* Audio (tick + alarm) */
/* NOTE: these are hosted assets - you can replace with local files if you like */
const tickSound = new Audio("tick tick.mp3");
tickSound.loop = true;
tickSound.volume = 0.06;

const alarmSound = new Audio("alarm.mp3"); // cool alarm; replace as desired
alarmSound.loop = true;
alarmSound.volume = 0.9;

/* responsive sizes */
function setRingSizes(){
  const vw = Math.min(window.innerWidth, window.innerHeight);
  const centerSize = 320; // clock-card width
  const outerMax = Math.min(vw * 0.92, 980);
  const monthsSize = Math.max(centerSize + 320, outerMax * 0.9);
  const dateSize   = Math.max(centerSize + 200, monthsSize * 0.75);
  const daysSize   = Math.max(centerSize + 80, dateSize * 0.6);

  setRingSize('monthsRing', monthsSize);
  setRingSize('dateRing', dateSize);
  setRingSize('daysRing', daysSize);

  rings.forEach(r=>{
    const el = document.getElementById(r.id);
    ringState[r.id].size = el.clientWidth;
    ringState[r.id].center = { x: el.clientWidth/2, y: el.clientHeight/2 };
    ringState[r.id].radius = (el.clientWidth/2) - 22; // padding inward
  });
}
function setRingSize(id, px){
  const el = document.getElementById(id);
  el.style.width = px + 'px';
  el.style.height = px + 'px';
}

/* create ring items & initial base angles */
function buildRings(){
  rings.forEach(r=>{
    const el = document.getElementById(r.id);
    el.innerHTML = '<div class="ring-border"></div>'; // clear & keep border element
    el.style.zIndex = 20;
    ringState[r.id] = {
      el,
      baseAngles: [],
      elements: [],
      rotation: 0,
      speed: r.speed,
      origSpeed: r.speed,
      dir: r.dir
    };
    const itemCount = r.items.length;
    for(let i=0;i<itemCount;i++){
      const span = document.createElement('div');
      span.className = 'item';
      span.textContent = r.items[i];
      el.appendChild(span);
      const base = (i / itemCount) * Math.PI * 2;
      ringState[r.id].baseAngles.push(base);
      ringState[r.id].elements.push(span);
    }
  });
}

/* animation loop for rings */
let lastTs = null;
function ringsAnimFrame(ts){
  if(!lastTs) lastTs = ts;
  const dt = (ts - lastTs)/1000; // seconds
  lastTs = ts;

  for(const r of rings){
    const id = r.id;
    const state = ringState[id];
    state.rotation += (state.speed || 0) * state.dir * dt * Math.PI * 2;
    if(state.rotation > Math.PI*2) state.rotation -= Math.PI*2;
    if(state.rotation < -Math.PI*2) state.rotation += Math.PI*2;

    const centerX = state.center.x;
    const centerY = state.center.y;
    const radius = state.radius;

    for(let i=0;i<state.elements.length;i++){
      const itemEl = state.elements[i];
      const angle = state.baseAngles[i] + state.rotation;
      const x = centerX + radius * Math.cos(angle);
      const y = centerY + radius * Math.sin(angle);
      itemEl.style.left = `${x}px`;
      itemEl.style.top  = `${y}px`;
      itemEl.style.transform = 'translate(-50%,-50%)';
      const scale = 1.0 + 0.08 * Math.cos(angle);
      itemEl.style.fontSize = `${12 * scale}px`;
      itemEl.style.opacity = `${0.7 + 0.2 * Math.cos(angle)}`;
    }
  }

  requestAnimationFrame(ringsAnimFrame);
}

/* clock update logic */
function pad(n){ return String(n).padStart(2,'0'); }
function updateClock(){
  const now = customDate ? new Date(customDate) : new Date();
  let h = now.getHours();
  let m = now.getMinutes();
  let s = now.getSeconds();

  let displayH = h;
  let ampm = '';
  if(!is24Hour){
    ampm = h >= 12 ? 'PM' : 'AM';
    displayH = h % 12 || 12;
  }

  if(lastValues.h !== displayH){
    animateChange(hoursText, pad(displayH));
    lastValues.h = displayH;
  }
  if(lastValues.m !== m){
    animateChange(minutesText, pad(m));
    lastValues.m = m;
  }
  if(lastValues.s !== s){
    animateChange(secondsText, pad(s));
    lastValues.s = s;
  }

  ampmEl.textContent = is24Hour ? '' : ampm;
  dateRow.textContent = now.toDateString();

  setBackgroundAndTextColor(h);

  // alarm check (trigger when second == 0 to avoid multiple triggers)
  checkAlarm(now);

  if(customDate) customDate = new Date(customDate.getTime() + 1000);
}

function animateChange(el, newText){
  const parent = el.parentElement;
  parent.classList.remove('flip');
  void parent.offsetWidth;
  el.textContent = newText;
  parent.classList.add('flip');
}

/* background & adaptive text color */
function setBackgroundAndTextColor(hour){
  let bg = images.morning;
  let darkText = false;
  if(hour >= 5 && hour < 9){ bg = images.sunrise; darkText = true; }
  else if(hour >= 9 && hour < 12){ bg = images.morning; darkText = true; }
  else if(hour >= 12 && hour < 17){ bg = images.afternoon; darkText = true; }
  else if(hour >= 17 && hour < 20){ bg = images.evening; darkText = false; }
  else { bg = images.night; darkText = false; }

  document.documentElement.style.setProperty('--darkText', darkText ? '#111' : '#fff');
  document.documentElement.style.setProperty('--brightText', darkText ? '#111' : '#fff');
  document.body.style.backgroundImage = `url('${bg}')`;

  const color = darkText ? '#111' : '#fff';
  document.querySelectorAll('.digit span, .date-row, .ampm, .ring .item').forEach(el=>{
    el.style.color = color;
    el.style.textShadow = `0 0 10px ${color}`;
  });
}

/* UI interactions (settings) */
settingsBtn.addEventListener('click', ()=>{
  settingsPanel.classList.toggle('open');
});

/* Apply/Clear custom date/time */
applyBtn.addEventListener('click', ()=>{
  const v = customDT.value;
  if(v){
    customDate = new Date(v);
    if(isNaN(customDate)) customDate = null;
  }
  settingsPanel.classList.remove('open');
});
clearBtn.addEventListener('click', ()=>{
  customDate = null;
  customDT.value = '';
});

/* toggle 12/24 */
formatToggle.addEventListener('click', ()=>{
  is24Hour = !is24Hour;
  formatToggle.classList.toggle('active', !is24Hour);
});

/* ring toggle */
ringToggle.addEventListener('click', ()=>{
  spinEnabled = !spinEnabled;
  ringToggle.classList.toggle('active', spinEnabled);
  document.body.classList.toggle('rings-hidden', !spinEnabled);
  rings.forEach(r=>{
    const s = ringState[r.id];
    if(!s) return;
    if(!spinEnabled) s.speed = 0;
    else s.speed = s.origSpeed ?? r.speed;
  });
});

/* tick toggle */
tickToggle.addEventListener('click', ()=>{
  tickEnabled = !tickEnabled;
  tickToggle.classList.toggle('active', tickEnabled);
  try {
    if(tickEnabled){
      tickSound.play().catch(()=>{/* play might be blocked until user interacts */});
    } else {
      tickSound.pause();
      tickSound.currentTime = 0;
    }
  } catch(e){ console.warn('tick play error', e); }
});

/* Alarm UI open/close */
openAlarm.addEventListener('click', ()=>{
  // hide settings, show overlay + modal
  settingsPanel.classList.remove('open');
  overlay.classList.add('show');
  alarmModal.classList.add('open');
});

cancelAlarm.addEventListener('click', ()=>{
  alarmModal.classList.remove('open');
  overlay.classList.remove('show');
});

/* Save Alarm (from time input) */
saveAlarm.addEventListener('click', ()=>{
  const v = alarmTime.value;
  if(v){
    const [hh, mm] = v.split(':');
    alarmSet = { h: parseInt(hh,10), m: parseInt(mm,10) };
    alert(`Alarm set for ${pad(alarmSet.h)}:${pad(alarmSet.m)}`);
  } else {
    alert('Please choose a time or use a preset.');
    return;
  }
  alarmModal.classList.remove('open');
  overlay.classList.remove('show');
});

/* Preset buttons */
document.querySelectorAll('.preset-buttons button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const mins = parseInt(btn.dataset.min, 10);
    const t = new Date(Date.now() + mins * 60000);
    alarmSet = { h: t.getHours(), m: t.getMinutes() };
    alert(`Alarm set for ${pad(alarmSet.h)}:${pad(alarmSet.m)}`);
    alarmModal.classList.remove('open');
    overlay.classList.remove('show');
  });
});

/* Check alarm and trigger */
function checkAlarm(now){
  if(alarmRinging) return; // already ringing
  if(!alarmSet) return;
  if(now.getHours() === alarmSet.h && now.getMinutes() === alarmSet.m && now.getSeconds() === 0){
    triggerAlarm();
  }
}

/* Trigger alarm */
function triggerAlarm(){
  alarmRinging = true;
  // show overlay + dismiss UI
  overlay.classList.add('show');
  dismissRow.classList.add('show');
  document.getElementById('alarmModal').classList.add('open');
  // play alarm sound loop
  alarmSound.play().catch(()=>{/* may be blocked until user interacts */});
}

/* Dismiss alarm */
dismissAlarmBtn.addEventListener('click', ()=>{
  stopAlarm();
});

function stopAlarm(){
  alarmSound.pause();
  alarmSound.currentTime = 0;
  alarmRinging = false;
  alarmSet = null;
  dismissRow.classList.remove('show');
  document.getElementById('alarmModal').classList.remove('open');
  overlay.classList.remove('show');
}

/* Startup & init */
function init(){
  buildRings();
  setRingSizes();
  window.addEventListener('resize', ()=>{ setRingSizes(); });
  rings.forEach(r=>{
    ringState[r.id].rotation = Math.random() * Math.PI*2 * 0.5;
  });

  // set initial toggle visual states
  if(spinEnabled) ringToggle.classList.add('active'); else ringToggle.classList.remove('active');
  if(tickEnabled) tickToggle.classList.add('active'); else tickToggle.classList.remove('active');

  requestAnimationFrame(ringsAnimFrame);

  // start clock interval (1s)
  updateClock();
  setInterval(updateClock, 1000);
}

/* ensure DOM ready */
document.addEventListener('DOMContentLoaded', init);
/* ===== Make alarm dismiss button draggable ===== */
(function(){
  const btn = dismissAlarmBtn; // already defined
  let isDragging = false, offsetX=0, offsetY=0;

  btn.style.position = 'absolute'; // ensure absolute positioning
  btn.style.cursor = 'grab';

  btn.addEventListener('mousedown', (e)=>{
    isDragging = true;
    offsetX = e.clientX - btn.offsetLeft;
    offsetY = e.clientY - btn.offsetTop;
    btn.style.cursor = 'grabbing';
  });

  window.addEventListener('mousemove', (e)=>{
    if(!isDragging) return;
    let x = e.clientX - offsetX;
    let y = e.clientY - offsetY;

    // constrain to window
    x = Math.max(0, Math.min(window.innerWidth - btn.offsetWidth, x));
    y = Math.max(0, Math.min(window.innerHeight - btn.offsetHeight, y));

    btn.style.left = x + 'px';
    btn.style.top  = y + 'px';
  });

  window.addEventListener('mouseup', ()=>{
    if(isDragging){
      isDragging = false;
      btn.style.cursor = 'grab';
    }
  });
})();

</script>
</body>
</html>
